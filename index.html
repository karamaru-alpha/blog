<!doctype html><html lang=ja><head><meta name=generator content="Hugo 0.85.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><title>からまるのブログ</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link href=/index.xml rel=alternate type=application/rss+xml title=からまるのブログ><meta property="og:title" content="からまるのブログ"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://karamaru-alpha.com/"><meta name=twitter:card content="summary"><meta name=twitter:title content="からまるのブログ"><meta name=twitter:description content><script src=/js/darkmode.js></script></head><body><nav class=nav><div class=nav-container><a href=/><h1 class=nav-title>からまるのブログ</h1></a><ul><li><a href=https://github.com/karamaru-alpha target=_blank rel="noopener noreferrer"><span>github</span></a></li><li><a href=https://twitter.com/karamarooon target=_blank rel="noopener noreferrer"><span>twitter</span></a></li></ul></div></nav><div id=darkModeToggle onclick=toggleDarkMode()>&#9680;</div><main><div class=catalogue><a href=https://karamaru-alpha.com/posts/layered-tx/ class=catalogue-item><div><time datetime="2023-12-16 12:14:44 +0900 +0900" class=catalogue-time>2023/12/16</time><h2 class=catalogue-title>レイヤードアーキテクチャにおけるトランザクションのエレガントな抽象化法2選</h2><div class=catalogue-line></div><p>この記事は技術書典『SGE Go Tech Book Vol.04』で自分が書いた章を書き直したものです。
レイヤードアーキテクチャにおけるトランザクションの実装（主に抽象化）の方法について、2つの例を紹介します。
本章のサンプルコードは次のURLから参照できます。
https://github.com/karamaru-alpha/tx-layer
レイヤードアーキテクチャにおけるトランザクション実装の悩みどころ レイヤードアーキテクチャとは レイヤードアーキテクチャとは責務によってシステムを複数の層に分割する設計手法です。 それぞれの層の関心を疎結合に保つことで、変更の影響範囲が制限される・テスト（モック）がしやすいなどのメリットがあるとされています。
以下は典型的なレイヤードアーキテクチャの層分けです。
プレゼンテーション(handler)層: ユーザーインターフェース・表示ロジックを担当する アプリケーション(usecase)層: ビジネスロジックの進行を担当する。プレゼンテーション層から値を受け取り、ドメイン層を活用して処理を進める ドメイン(domain)層: モデルの定義・振る舞いを定義する。データベースアクセスの抽象Repositoryに代表される、アプリケーション層とインフラストラクチャ層の中継役も担う インフラストラクチャ(infra)層: データベースなど外部サービスへのアクセスを主に担当する 密結合なトランザクション実装例 レイヤードアーキテクチャを採用したコードにおいて、トランザクションはどのように実装するのが良いでしょうか？ 「MySQLに保存されているユーザーの名前を更新する」というケースを例として考えてみましょう。
さて、ユースケース単位でトランザクションを張りたい場合、愚直に実装すると以下のようになります。 （本章ではMySQLとの疎通にGoの標準パッケージdatabase/sqlの拡張であるsqlxパッケージを用います）
package構成$ tree ./anti-pattern/ ├── domain │ └── repository │ └── user.go ├── infra │ └── mysql │ └── repository │ └── user.go └── usecase └── user.go anti-pattern/usecase/user.gotype UserInteractor interface { UpdateName(ctx context.Context, userID, name string) error } type userInteractor struct { db *sqlx.</p></div></a><a href=https://karamaru-alpha.com/posts/init-vtuber/ class=catalogue-item><div><time datetime="2023-12-13 03:00:36 +0900 +0900" class=catalogue-time>2023/12/13</time><h2 class=catalogue-title>生成AIを用いて2日でVTuberモデルを作成しアバターで会議に出るまで</h2><div class=catalogue-line></div><p><p>絵を描いたことないバックエンドエンジニアが、生成AIの力を借りながらVTuberモデルを作成し、MacBookPro単体でアバターでZoomやハドルに出るまでの全てを書きました。
&ldquo;アバター作りたいけど絵描けないしなんか大変そう&mldr;&ldquo;と思ってる人に参考にしてもらえれば幸いです。
2徹しました。</p></p></div></a><a href=https://karamaru-alpha.com/posts/useful-tarminal-tool/ class=catalogue-item><div><time datetime="2023-11-17 01:44:19 +0900 +0900" class=catalogue-time>2023/11/17</time><h2 class=catalogue-title>個人的優勝ターミナルツール3選(warp/z/peco)</h2><div class=catalogue-line></div><p><p>業務効率爆上がりな主観的おすすめターミナルツール3選を推す記事です🔥</p></p></div></a><a href=https://karamaru-alpha.com/posts/isumaru/ class=catalogue-item><div><time datetime="2023-10-02 00:12:48 +0900 +0900" class=catalogue-time>2023/10/02</time><h2 class=catalogue-title>対isuconメトリクスツールisumaru作った</h2><div class=catalogue-line></div><p><p>対isuconメトリクスツール"isumaru"作りました。</p></p></div></a><a href=https://karamaru-alpha.com/posts/try-extism/ class=catalogue-item><div><time datetime="2023-04-01 17:06:45 +0900 +0900" class=catalogue-time>2023/04/01</time><h2 class=catalogue-title>wasmプラグインの作成/呼び出しを多言語でできるExtismを試す</h2><div class=catalogue-line></div><p><p>先日はWASM I/Oがありましたね。
中でも、wasmプラグインの作成/呼び出しを言語跨ぎでできるExtismが気になったので試してみました。</p></p></div></a><a href=https://karamaru-alpha.com/posts/create-wasm-compiler/ class=catalogue-item><div><time datetime="2023-03-01 05:25:00 +0900 +0900" class=catalogue-time>2023/03/01</time><h2 class=catalogue-title>自作言語をwasm変換するコンパイラをrustで作った</h2><div class=catalogue-line></div><p><p>rust/wasmに入門するために、自作言語をwasmバイナリにマッピングするコンパイラを作りました。</p><p>機能は限定的で、四則演算を関数としてexportし、wasmで呼び出すまでを実装しています。</p><p>どちらも初めて1ヶ月程度の知識なので細かい点はご容赦くださいmm</p></p></div></a><a href=https://karamaru-alpha.com/posts/consider-saving-strategy/ class=catalogue-item><div><time datetime="2023-01-08 00:16:21 +0900 +0900" class=catalogue-time>2023/01/08</time><h2 class=catalogue-title>貯金に適した口座の使い分けを考えてみる</h2><div class=catalogue-line></div><p><p>新社会人になって8ヶ月経ちました。からまるです。</p><p>最近、意図せず口座からお金がなくなっていっています。「貯金とは毎月のお賃金×経過月数」というのは幻で、学生に比べ多くの給料を貰え行動範囲がぐっと広がる新社会人が素直にお金を貯められる訳がありませんでした。</p></p></div></a><a href=https://karamaru-alpha.com/posts/hello-world/ class=catalogue-item><div><time datetime="2023-01-02 22:47:33 +0900 +0900" class=catalogue-time>2023/01/02</time><h2 class=catalogue-title>hello world!</h2><div class=catalogue-line></div><p>独自ドメインのブログってなんかかっこいいですよねーー！ だから初めてみました。</p></div></a></div><div class=pagination><span>1</span></div></main><footer><span>&copy; <time datetime="2023-12-16 03:47:25.933916382 +0000 UTC m=+0.066421143">2023</time> karamaru. Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>