<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>golangci-lintã§æœ‰åŠ¹ãªå…¨ã¦ã®linterã®å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆæ¸¬ã™ã‚‹æ–¹æ³• &#183; ã‹ã‚‰ã¾ã‚‹ã®ãƒ–ãƒ­ã‚°</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/images/ren.png><link href rel=alternate type=application/rss+xml title=ã‹ã‚‰ã¾ã‚‹ã®ãƒ–ãƒ­ã‚°><meta property="og:title" content="golangci-lintã§æœ‰åŠ¹ãªå…¨ã¦ã®linterã®å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆæ¸¬ã™ã‚‹æ–¹æ³•"><meta property="og:description" content="ç§ã¯ã“ã®æ–¹æ³•ã§30mã‹ã‹ã£ã¦ã„ãŸCIã‚’5mã«ã—ã¾ã—ãŸã€‚ã¾ã˜ã§ã™ã€‚ã‚ã¨å½¼å¥³ã‚‚ã§ãã¾ã—ãŸã€‚å˜˜ã§ã™ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://karamaru-alpha.com/posts/golangci-lint-measure/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-09T00:16:21+09:00"><meta property="article:modified_time" content="2024-08-09T00:16:21+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="golangci-lintã§æœ‰åŠ¹ãªå…¨ã¦ã®linterã®å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆæ¸¬ã™ã‚‹æ–¹æ³•"><meta name=twitter:description content="ç§ã¯ã“ã®æ–¹æ³•ã§30mã‹ã‹ã£ã¦ã„ãŸCIã‚’5mã«ã—ã¾ã—ãŸã€‚ã¾ã˜ã§ã™ã€‚ã‚ã¨å½¼å¥³ã‚‚ã§ãã¾ã—ãŸã€‚å˜˜ã§ã™ã€‚"><script src=/js/darkmode.js></script></head><body><nav class=nav><div class=nav-container><a href=/><h2 class=nav-title>ã‹ã‚‰ã¾ã‚‹ã®ãƒ–ãƒ­ã‚°</h2></a><ul><li><a href=https://github.com/karamaru-alpha target=_blank rel="noopener noreferrer"><span>GitHub</span></a></li><li><a href=https://x.com/karamaru_alpha target=_blank rel="noopener noreferrer"><span>X</span></a></li><li><a href=https://speakerdeck.com/karamaru target=_blank rel="noopener noreferrer"><span>SpeackerDeck</span></a></li><li><a href=https://www.linkedin.com/in/karamaru target=_blank rel="noopener noreferrer"><span>LinkedIn</span></a></li><li><a href=https://karamaru-alpha.com/index.xml target=_blank rel="noopener noreferrer"><span>RSS</span></a></li></ul></div></nav><div id=darkModeToggle onclick=toggleDarkMode()>&#9680;</div><main><div class=post><div class=post-info><time datetime="2024-08-09 00:16:21 +0900 +0900">2024/08/09</time></div><h1 class=post-title>golangci-lintã§æœ‰åŠ¹ãªå…¨ã¦ã®linterã®å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆæ¸¬ã™ã‚‹æ–¹æ³•</h1><div class=post-line></div><p>ç§ã¯ã“ã®æ–¹æ³•ã§30mã‹ã‹ã£ã¦ã„ãŸCIã‚’5mã«ã—ã¾ã—ãŸã€‚ã¾ã˜ã§ã™ã€‚ã‚ã¨å½¼å¥³ã‚‚ã§ãã¾ã—ãŸã€‚å˜˜ã§ã™ã€‚</p><h2 id=å…ˆã«çµè«–>å…ˆã«çµè«–</h2><ol><li>verboseã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œæ™‚é–“Top10ã®stageä¸€è¦§ã‚’ã¿ã‚‹</li><li>ã‚³ãƒ¼ãƒ‰æ”¹å¤‰ã—ã¦æœ‰åŠ¹ãªå…¨ã¦ã®linterã®å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆæ¸¬ã™ã‚‹</li></ol><h2 id=1-verboseã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œæ™‚é–“top10ã®stageä¸€è¦§ã‚’ã¿ã‚‹>1. verboseã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œæ™‚é–“Top10ã®stageä¸€è¦§ã‚’ã¿ã‚‹</h2><p>å¤šãã®å ´åˆã¯ã“ã¡ã‚‰ã®æ–¹æ³•ã§äº‹è¶³ã‚Šã‚‹æ°—ãŒã—ã¾ã™ã€‚</p><p>å®Ÿè¡Œæ™‚<code>--verbose</code>ã‚‚ã—ãã¯<code>-v</code>ã‚’ã¤ã‘ã‚‹ã“ã¨ã§ã‚ˆã‚Šè©³ç´°ãªå®Ÿè¡ŒçµæœãŒé–²è¦§ã§ãã¾ã™ã€‚</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>golangci-lint run --verbose
</code></pre></div><p>cf. <a href=https://golangci-lint.run/usage/configuration/#command-line-options>https://golangci-lint.run/usage/configuration/#command-line-options</a></p><p>ã“ã®å‡ºåŠ›çµæœã®ä¸­ã«ã€å®Ÿè¡Œæ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹stageã®Top10ãŒå‡ºã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚
ä»¥ä¸‹ç”»åƒã ã¨<a href=https://github.com/securego/gosec>gosec</a>ãŒæœ€ã‚‚é‡ã„Linterã§ã™ã­ã€‚æ¬¡ç‚¹ã§<a href=https://github.com/go-critic/go-critic>gocritic</a>ã€‚</p><p>CIè‡ªä½“ã®æ™‚é–“ã¯30mã§ã™ãŒã€golangci-lintã¯ä¸¦è¡Œå®Ÿè¡Œã«å¯¾å¿œã—ã¦ã„ã‚‹ã®ã§æ™‚é–“ãŒå¤§ããå‡ºã¦ã„ã¾ã™ã­ã€‚</p><p><img src=before.png alt=before.png></p><p>ã“ã“ã¾ã§åˆ†ã‹ã‚Œã°ã‚ã¨ã¯å¯¾è±¡ã®linterã®ã†ã¡ã©ã®ãƒ«ãƒ¼ãƒ«ãŒé…ã„ã®ã‹ã‚’èª¿ã¹ã¦æ”¹å–„ã™ã‚‹ã ã‘ã§ã™ã­ã€‚</p><p>ä»Šå›ã®ä¾‹ã ã¨é‹è‰¯ãgosecã®G602ãŒé…ã„ã¨ã„ã†ã“ã¨ãŒè¦‹ã¤ã‘ã‚‰ã‚ŒãŸã®ã§ã€ã“ã‚Œã‚’ignoreã™ã‚‹ã“ã¨ã§CIã®æ™‚é–“ã‚’30mã‹ã‚‰5mã¾ã§çŸ­ç¸®ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚(ã™ã”ã„ï¼)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>linters-settings</span>:
  <span style=color:#f92672>gosec</span>:
    <span style=color:#f92672>excludes</span>:
      - <span style=color:#ae81ff>G602</span>
</code></pre></div><p>cf. <a href=https://github.com/golangci/golangci-lint/issues/4039>https://github.com/golangci/golangci-lint/issues/4039</a>
cf. <a href=https://github.com/securego/gosec/issues/1007>https://github.com/securego/gosec/issues/1007</a></p><p><img src=after.png alt=after.png></p><p>gosecã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è©±ã¯çµæ§‹å‰ã®ã‚‚ã®ãªã®ã§ã‚‚ã†æ²»ã£ã¦ã‚‹ã‹ã‚‚ã§ã™ã­ã€‚
ã‘ã©ã€é…ã„linterã‚’ç‰¹å®šã™ã‚‹æ‰‹é †è‡ªä½“ã¯å‚è€ƒã«ãªã‚‹ã‚“ã˜ã‚ƒãªã„ã‚“ã§ã—ã‚‡ã†ã‹ã€‚</p><h2 id=2-ã‚³ãƒ¼ãƒ‰æ”¹å¤‰ã—ã¦æœ‰åŠ¹ãªå…¨ã¦ã®linterã®å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆæ¸¬ã™ã‚‹>2. ã‚³ãƒ¼ãƒ‰æ”¹å¤‰ã—ã¦æœ‰åŠ¹ãªå…¨ã¦ã®linterã®å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆæ¸¬ã™ã‚‹</h2><p>ã“ã“ã‹ã‚‰ã¯ç‰©å¥½ããªäººå‘ã‘ã§ã™ã­ã€‚</p><p>ãã‚‚ãã‚‚verboseã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦å®Ÿè¡Œã—ãŸæ™‚ã«å®Ÿè¡Œæ™‚é–“Top10ãŒå‡ºã¦ãã‚‹ä»•çµ„ã¿ã¯ã©ã“ã«ã‚ã‚‹ã‚“ã§ã—ã‚‡ã†ã‹ï¼Ÿ</p><p>ç­”ãˆã¯<a href=https://github.com/golangci/golangci-lint/blob/a9ea7d32dc8eb641d67d720f9a5415247ab3bc1b/pkg/goanalysis/runners.go#L36>pkg/goanalysis/runners.go</a>ã‚ãŸã‚Šã§ã€å›ºå®šå€¤10ã‚’å¼•æ•°ã«ã€å®Ÿè¡Œæ™‚é–“ã‚’å‡ºåŠ›ã—ã¦ãã†ãªã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>stagesToPrint</span> = <span style=color:#ae81ff>10</span>
<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>sw</span>.<span style=color:#a6e22e>PrintTopStages</span>(<span style=color:#a6e22e>stagesToPrint</span>)
</code></pre></div><p>ãã—ã¦å®Ÿéš›ã«stageã‚’å®Ÿè¡Œæ™‚é–“é †ã«sortã—ãŸå¾Œå‡ºåŠ›ã™ã‚‹ã®ã¯<a href=https://github.com/golangci/golangci-lint/blob/a9ea7d32dc8eb641d67d720f9a5415247ab3bc1b/pkg/timeutils/stopwatch.go>pkg/timeutils/stopwatch.go</a>ã§ã™ã€‚
å¼•æ•°ã®nãŒ<code>stagesToPrint=10</code>ã§ã™ã­ã€‚</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Stopwatch</span>) <span style=color:#a6e22e>sprintTopStages</span>(<span style=color:#a6e22e>n</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>string</span> {}
    <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>stages</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>noStagesText</span>
    }
    <span style=color:#a6e22e>stageDurations</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>stageDurationsSorted</span>()
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>stagesStrings</span> []<span style=color:#66d9ef>string</span>
    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; len(<span style=color:#a6e22e>stageDurations</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>n</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
        <span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>stageDurations</span>[<span style=color:#a6e22e>i</span>]
        <span style=color:#a6e22e>stagesStrings</span> = append(<span style=color:#a6e22e>stagesStrings</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%s: %s&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>d</span>))
    }

    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;top %d stages: %s&#34;</span>, <span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>stagesStrings</span>, <span style=color:#e6db74>&#34;, &#34;</span>))
}
</code></pre></div><p>ãã†ãªã‚“ã§ã™ã€ã“ã“ã¾ã§ãã‚Œã°ã‚‚ã†ãŠã‚ã‹ã‚Šã§ã™ã­ã€‚</p><p>golangci-lintã®ã‚³ãƒ¼ãƒ‰ã‚’è½ã¨ã—ã¦ãã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸå¾Œã€<code>make build</code>ã‚’ã™ã‚Œã°å…¨ã¦ã®æœ‰åŠ¹ãªstageã®å®Ÿè¡Œæ™‚é–“ã‚’å‡ºåŠ›ã•ã›ã‚‹golangci-lintãƒã‚¤ãƒŠãƒªã‚’ä½œã‚‹ã“ã¨ãŒã§ãã‚‹ã‚“ã§ã™ğŸ‘</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Stopwatch</span>) <span style=color:#a6e22e>sprintTopStages</span>(<span style=color:#a6e22e>n</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>string</span> {
	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>stages</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>noStagesText</span>
	}
	<span style=color:#a6e22e>stageDurations</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>stageDurationsSorted</span>()
	<span style=color:#75715e>// ==================== ä»¥ä¸‹ãƒ‡ãƒãƒƒã‚°
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>type</span> <span style=color:#a6e22e>stageDurationDetail</span> <span style=color:#66d9ef>struct</span> {
		<span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>
		<span style=color:#a6e22e>ms</span>   <span style=color:#66d9ef>int</span>
	}
	<span style=color:#a6e22e>details</span> <span style=color:#f92672>:=</span> make([]<span style=color:#a6e22e>stageDurationDetail</span>, <span style=color:#ae81ff>0</span>, len(<span style=color:#a6e22e>stageDurations</span>))
	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>stageDurations</span> {
		<span style=color:#a6e22e>details</span> = append(<span style=color:#a6e22e>details</span>, <span style=color:#a6e22e>stageDurationDetail</span>{
			<span style=color:#a6e22e>name</span>: <span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>name</span>,
			<span style=color:#a6e22e>ms</span>:   int(<span style=color:#a6e22e>v</span>.<span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>Milliseconds</span>()),
		})
	}
	panic(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%+v&#34;</span>, <span style=color:#a6e22e>details</span>))
	<span style=color:#75715e>// ==================== ãƒ‡ãƒãƒƒã‚°ãŠã—ã¾ã„
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>stagesStrings</span> []<span style=color:#66d9ef>string</span>
	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; len(<span style=color:#a6e22e>stageDurations</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>n</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
		<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>stageDurations</span>[<span style=color:#a6e22e>i</span>]
		<span style=color:#a6e22e>stagesStrings</span> = append(<span style=color:#a6e22e>stagesStrings</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;%s: %s&#34;</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>d</span>))
	}

	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;top %d stages: %s&#34;</span>, <span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>stagesStrings</span>, <span style=color:#e6db74>&#34;, &#34;</span>))
}
</code></pre></div><p>èª°ãŒã“ã“ã¾ã§è¦‹ãŸã„ã­ã‚“ï¼ã¨æ€ã†æ°—ã‚‚ã—ã¾ã™ãŒã€æ°—ãŒè¿·ã£ãŸæ™‚ã«è¦—ã„ã¦ã¿ã¦ãã ã•ã„ğŸ™†</p><p><img src=img.png alt=img.png></p><h2 id=çµ‚ã‚ã‚Šã«>çµ‚ã‚ã‚Šã«</h2><p>è‰²ã€…æ›¸ãã¾ã—ãŸãŒgolangci-lintã®åŸºæœ¬ã¯ä»¥ä¸‹ã ã¨æ€ã£ã¦ã„ã¾ã™ã€‚</p><ul><li>disable-allã—ã¦å¿…è¦ãªã‚‚ã®ã ã‘enableã™ã‚‹</li><li>é©å®œçµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹(ãƒ­ãƒ¼ã‚«ãƒ«ã‚’dockerèµ·å‹•ã—ã¦ã„ã‚‹å ´åˆã¯GOCACHE/GOLANGCI_LINT_CACHEã®è¨­å®šã«æ³¨æ„)<ul><li><a href=https://github.com/pipe-cd/pipecd/pull/4628>https://github.com/pipe-cd/pipecd/pull/4628</a></li></ul></li></ul><p><a href=https://golangci-lint.run/product/performance/>GOGCã‚’èª¿æ•´ã—ãŸã‚Š</a>ä¸¦è¡Œæ•°ã‚’å¤‰ãˆãŸã‚Šã€ç´°ã‹ã„ã¨ã“ã‚ã‚’å¤‰ãˆã‚‹å‰ã«ãƒ«ãƒ¼ãƒ«ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®è¦‹ç›´ã—ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚
ãã‚Œã§ã¯ã€æ¥½ã—ã„lintãƒ©ã‚¤ãƒ•ã‚’ï¼</p></div><div class=pagination><a href=/posts/ab-build-self-host/ class="left arrow">&#8592;</a>
<a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2024-08-08 16:50:52.182467852 +0000 UTC m=+0.062629485">2024</time> karamaru. Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>