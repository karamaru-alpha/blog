<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>p5.jsとtone.jsで作るドラムパターンビジュアライザー &#183; からまるのブログ</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/images/ren.png><link href rel=alternate type=application/rss+xml title=からまるのブログ><meta property="og:title" content="p5.jsとtone.jsで作るドラムパターンビジュアライザー"><meta property="og:description" content="QualiArts Advent Calender 2024の23日目担当です！
MIDIファイルから読み込んだドラムパターンをビジュアライズしました。"><meta property="og:type" content="article"><meta property="og:url" content="https://karamaru-alpha.com/posts/drum-visualizer/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-23T00:12:48+09:00"><meta property="article:modified_time" content="2024-12-23T00:12:48+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="p5.jsとtone.jsで作るドラムパターンビジュアライザー"><meta name=twitter:description content="QualiArts Advent Calender 2024の23日目担当です！
MIDIファイルから読み込んだドラムパターンをビジュアライズしました。"><script src=/js/darkmode.js></script></head><body><nav class=nav><div class=nav-container><a href=/><h2 class=nav-title>からまるのブログ</h2></a><ul><li><a href=https://github.com/karamaru-alpha target=_blank rel="noopener noreferrer"><span>GitHub</span></a></li><li><a href=https://x.com/karamaru_alpha target=_blank rel="noopener noreferrer"><span>X</span></a></li><li><a href=https://speakerdeck.com/karamaru target=_blank rel="noopener noreferrer"><span>SpeackerDeck</span></a></li><li><a href=https://www.linkedin.com/in/karamaru target=_blank rel="noopener noreferrer"><span>LinkedIn</span></a></li><li><a href=https://karamaru-alpha.com/index.xml target=_blank rel="noopener noreferrer"><span>RSS</span></a></li></ul></div></nav><div id=darkModeToggle onclick=toggleDarkMode()>&#9680;</div><main><div class=post><div class=post-info><time datetime="2024-12-23 00:12:48 +0900 +0900">2024/12/23</time></div><h1 class=post-title>p5.jsとtone.jsで作るドラムパターンビジュアライザー</h1><div class=post-line></div><p><a href=https://qiita.com/advent-calendar/2024/qualiarts>QualiArts Advent Calender 2024</a>の23日目担当です！</p><p>MIDIファイルから読み込んだドラムパターンをビジュアライズしました。</p><h2 id=先に結論>先に結論</h2><p>こんな感じ！
MIDIファイルからドラムやキック、シンバルの音を判別して、いい感じに表示してくれるんだ！</p><blockquote class=twitter-tweet><a href="https://twitter.com/karamaru_alpha/status/1871030185786785908?ref_src=twsrc%5Etfw"></a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/YLoN1-oWz9A style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><p>カラム数も調整できるから、8×2とかもいけちゃう！
かわいい！MVのパーツっぽくて素敵！</p><p><img src=./8.png alt=8.png></p><h2 id=使用技術とソース>使用技術とソース</h2><ul><li><a href=https://github.com/processing/p5.js>p5.js</a><ul><li>描画周りをめちゃラップしてくれてるやつ</li></ul></li><li><a href=https://github.com/Tonejs/Midi>tonejs/midi</a><ul><li>音を出したりMIDIファイルを読み込んだりしてくれるやつ</li></ul></li><li><a href=https://www.typescriptlang.org/>typescript</a></li><li><a href=https://parceljs.org/>parcel</a></li></ul><p><a href=https://github.com/karamaru-alpha/canvas>https://github.com/karamaru-alpha/canvas</a></p><h2 id=作った経緯>作った経緯</h2><p>今年のアドカレはRustでvimを作るぞーーって思ってたんです。 海外に<a href=https://www.flenker.blog/hecto/>既にチュートリアル</a>があって、これを参考に作る感じで。</p><p>けどviewerまで作った段階で、結構写経だけだからアドカレとしては退屈かもな〜思って、担当日前日で題材変更を決意しました。
(この資料自体は素晴らしいんですけどね！）</p><p>残骸↓
<a href=https://github.com/karamaru-alpha/rim>https://github.com/karamaru-alpha/rim</a></p><p>じゃあ何を作ろうかな〜って考えてたら、最近自分が好きな新進気鋭<a href=https://x.com/Symmez/status/1837145735399363032/video/1>ボカロP新目鳥さんのMusicVideo</a>がめっちゃカッコよかったことを思い出して、これを作りたい！って思いました。
p5.jsを使用しているって情報はあった(というかその情報しかないけど)ので、頑張って作ろうと思いました。</p><p>動画にはピアノの音程とかいっぱい入っててすごいけど、 とりあえず今回はドラムのビジュアライザー作りました！</p><h2 id=仕組みと流れ>仕組みと流れ</h2><p>LogicProで作成したドラムトラックをMIDIファイルに書き出し、tone.jsで読み込んでビジュアライズしました。</p><h3 id=1-非営利目的で利用可能な音源を探す>1. 非営利目的で利用可能な音源を探す</h3><p>今回は自分が好きな<a href=https://piapro.jp/t/tms7>ごめんなさいが言えなくてさんのアイジョウショウメイ</a>をお借りしました。</p><p><img src=./gomeie.png alt=gomeie.png></p><h3 id=2-logic-pro-に読み込み---ドラムパターンを打ち込み>2. Logic Pro に読み込み -> ドラムパターンを打ち込み</h3><p>本プログラムではドラム専用のトラックに打ち込みが必要です。 piaproからのダウンロードはmp3(オーディオ波形の)形式で落ちてくるので、このまま使用することはできないんですね。</p><p>最終おててで入力するしかないのですが、耳コピしやすいようにLogic Proのstem Splitterでドラムのみの音源を抽出後、それに合う形で打ち込みを行いました。</p><p>正直今回はバスドラム・スネア・シンバルの場所さえ大体打ち込めていればいいのでそんなにする必要もないのですが、雰囲気が大事ってことでmm</p><p><img src=./logic.png alt=logic.png></p><h3 id=3-midiファイルに書き出し---tonejsでjsonts型に変換>3. MIDIファイルに書き出し -> tone.jsでJSON/ts型に変換</h3><p>先ほど手書きしたドラムのトラックをMIDIファイルで書き出し、 tone.jsを用いて読み込みます。</p><p>tone.jsで読み込んだ後に参照できる値は<a href="https://github.com/Tonejs/Midi?tab=readme-ov-file#format">こちら</a>をご覧ください。</p><p><code>notes</code>が音の配列で、各<code>tone</code>に音の登録番号<code>midi</code>や始点<code>ticks</code>などを取得することができます。</p><h3 id=4-p5jsで描画>4. p5.jsで描画</h3><p>あとはいい感じにp5.jsでアニメーションしながら、ドラムの音に合わせて描画するだけです。
シンバル>スネア>バスドラムの順で、拍子の中にある音色に応じて模様を変更するようにしています。</p><ul><li>シンバル: 四角くるくる</li><li>スネア: くりぬき四角</li><li>バスドラ: 四角</li><li>その他: 斜線</li></ul><p><a href=https://github.com/karamaru-alpha/canvas/blob/main/README.md>https://github.com/karamaru-alpha/canvas/blob/main/README.md</a></p><h2 id=感想>感想</h2><p>毎フレーム描画されるみたいなやつに触れたことがなかったのでシンプルにおもちゃとして楽しかった！
拍子の計算とかは結構難しかった(し多分リズムも少しずれてる)ので、もう少しいい感じにできたらよかったかな>&lt;
けど1日で作ったものとしては満足！好奇心が満たされました！👏</p></div><div class=pagination><a href=/posts/unique-package/ class="left arrow">&#8592;</a>
<a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2024-12-23 06:25:41.015389384 +0000 UTC m=+0.042899269">2024</time> karamaru. Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>