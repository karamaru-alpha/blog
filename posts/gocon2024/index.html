<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Go Conference 2024 に登壇しました！ &#183; からまるのブログ</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><link rel=icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/images/ren.png><link href rel=alternate type=application/rss+xml title=からまるのブログ><meta property="og:title" content="Go Conference 2024 に登壇しました！"><meta property="og:description" content="2024/06/08に開催された Go Conference 2024 に登壇してきました！
初めて外部登壇した感想や採択から発表に至るまでの準備、セッションで話しきれなかったことについて書きたいと思います！"><meta property="og:type" content="article"><meta property="og:url" content="https://karamaru-alpha.com/posts/gocon2024/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-09T10:42:42+09:00"><meta property="article:modified_time" content="2024-06-09T10:42:42+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go Conference 2024 に登壇しました！"><meta name=twitter:description content="2024/06/08に開催された Go Conference 2024 に登壇してきました！
初めて外部登壇した感想や採択から発表に至るまでの準備、セッションで話しきれなかったことについて書きたいと思います！"><script src=/js/darkmode.js></script></head><body><nav class=nav><div class=nav-container><a href=/><h2 class=nav-title>からまるのブログ</h2></a><ul><li><a href=https://github.com/karamaru-alpha target=_blank rel="noopener noreferrer"><span>GitHub</span></a></li><li><a href=https://x.com/karamaru_alpha target=_blank rel="noopener noreferrer"><span>X</span></a></li><li><a href=https://karamaru-alpha.com/index.xml target=_blank rel="noopener noreferrer"><span>RSS</span></a></li></ul></div></nav><div id=darkModeToggle onclick=toggleDarkMode()>&#9680;</div><main><div class=post><div class=post-info><time datetime="2024-06-09 10:42:42 +0900 +0900">2024/06/09</time></div><h1 class=post-title>Go Conference 2024 に登壇しました！</h1><div class=post-line></div><p>2024/06/08に開催された Go Conference 2024 に登壇してきました！</p><p>初めて外部登壇した感想や採択から発表に至るまでの準備、セッションで話しきれなかったことについて書きたいと思います！</p><h2 id=はじめに>はじめに</h2><p><a href=https://gocon.jp/2024/>Go Conference 2024</a> に登壇してきました！</p><ul><li><a href=https://gocon.jp/2024/sessions/14/>gocon.jp - 詳解 &ldquo;Fixing For Loops in Go 1.22&rdquo; / 自作linterをgolangci-lintへコントリビュートした話</a></li><li><a href=https://speakerdeck.com/qualiarts/xiang-jie-fixing-for-loops-in-go-1-dot-22-zi-zuo-linterwogolangci-linthekontoribiyutositahua>speakerdeck.com - スライド全文</a></li></ul><blockquote class=twitter-tweet><a href="https://twitter.com/karamaru_alpha/status/1799330747482054831?ref_src=twsrc%5Etfw"></a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>今回のブログでは、CfPの提出~調査~登壇までの流れを書いて、セッションでは話せなかったポイントなどについても記述したいと思います。</p><h2 id=目次>目次</h2><ul><li>CfPを提出するまで</li><li>CfPを提出してから登壇に至るまで</li><li>登壇当日</li><li>セッションの要約・推しポイント・話しきれなかったこと</li></ul><h2 id=cfpを提出するまで>CfPを提出するまで</h2><p>今回のセッションはいわゆる「登壇駆動」でした。
登壇駆動というのは、面白そうな仕様や挙動を見つけてCfPを出し、その"後"にそれらの謎を証明していくという順番の発表/勉強手法のことです。
登壇界隈ではよく用いられる(自分も便利だと思う)テクニックですが、これってある種知識の前借りというか、登壇までに必ず提示した謎を証明しないといけないというリスクと責任が伴う行為ですよね。
このせいでスライド作成に行き詰まるなど非常に苦しい時間もあったのですが、なんとか解ききって発表にこぎつけられてよかったです&mldr;!</p><p>今回でいうと「Go1.22でループ変数のアドレスを出力する時、fmtパッケージとビルトイン関数で挙動が違う」という"お題"だけ先に見つけてCfPを出しました。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#ae81ff>3</span> {
	<span style=color:#75715e>// 全てのイテレーションで&#34;異なる&#34;アドレスを出力する
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>v</span>)
}

<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#ae81ff>3</span> {
	<span style=color:#75715e>// 全てのイテレーションで&#34;同一の&#34;アドレスを出力する
</span><span style=color:#75715e></span>	println(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>v</span>)
}
</code></pre></div><p>このお題を見つけた時、心から面白いと思いました。</p><p>(自分を含めた)多くのGopherさんが「Go1.22からイテレーション毎に値が再定義されるようになった」という話を100回は聞いていて、もう少し詳しいGopherさんは「ループ変数がアドレス取得かクロージャキャプチャされる場合のみ再定義される」というところまで理解していたでしょう。
そんな前提知識があるからこそ、「ループ変数のアドレス取得がされているのにもかかわらず挙動が違う場合がある」というこのお題は、一見仕様と矛盾するように思えて好奇心が掻き立てられました。</p><p>golangci-lintへのコントリビューションもCfPのタイトルに入れたのですが、結果登壇ではエスケープ解析を含むコンパイラの説明に20分かけ、残りの(残ってない)30秒をlinterの紹介に当てる結果になりました。
厳密にいうとスライド自体は作成したんですが、どうしても20分では話しきれない枚数になってしまって省略せざるを得なくなってしまい、タイトルが半分釣りみたいになったのが申し訳なかったですmm</p><p>初めての登壇且つコントリビューションを含むということで「ChallengeSession」として応募しました。
publicなセッション紹介には出ていませんが、運営への備考欄で熱い気持ちを書いた記憶があります🔥</p><p><a href=https://gocon.jp/2024/sessions/14/>gocon.jp - 詳解 &ldquo;Fixing For Loops in Go 1.22&rdquo; / 自作linterをgolangci-lintへコントリビュートした話</a></p><h2 id=cfpを提出してから登壇に至るまで>CfPを提出してから登壇に至るまで</h2><p>CfPが通ったのを知った時は「ずっと見ていたgoconに登壇できるんだ！」とすごく嬉しかったです！！🎉
「個人開発/研究で登壇する」のがエンジニア人生の1つの目標だったということもあり、田園都市線でにやにやしながらツイートしたのを覚えています🚃</p><blockquote class=twitter-tweet><a href="https://twitter.com/karamaru_alpha/status/1775902582915096806?ref_src=twsrc%5Etfw"></a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>さて、登壇駆動でCfPを通したのですから、次は謎を解明する義務がありますね。
幸い、ループについてのプロポーザルやドキュメント、大まかなコードの変更箇所は知っていたので、これを追っていけば自ずとわかるだろうと高を括っていました。これが大きな間違いでしたorz</p><p>具体的には下記あたりで、for-loopについての議論やプロポーザル、実装箇所やFAQを見ることができます。
登壇スライドは1章~5章の構成なのですが、これらのソースは1章~3章にあたります。</p><ul><li><a href=https://github.com/golang/go/discussions/56010>https://github.com/golang/go/discussions/56010</a></li><li><a href=https://github.com/golang/go/issues/60078>https://github.com/golang/go/issues/60078</a></li><li><a href=https://go.googlesource.com/proposal/+/master/design/60078-loopvar.md>https://go.googlesource.com/proposal/+/master/design/60078-loopvar.md</a></li><li><a href=https://go.dev/wiki/LoopvarExperiment>https://go.dev/wiki/LoopvarExperiment</a></li><li><a href=https://github.com/golang/go/issues/57969>https://github.com/golang/go/issues/57969</a></li><li><a href=https://go-review.googlesource.com/c/go/+/411904>https://go-review.googlesource.com/c/go/+/411904</a></li></ul><p>さて、上記で全てが説明できると思っていたのですが、実際そう簡単にはいきませんでした。</p><p>冒頭で見つけたfmtパッケージとビルトイン関数での挙動の違いについて、アップデートの差分を見るだけでは何も説明がつかなかったのです。 「どちらのケースであってもコンパイラが中間表現(IR)ノードを書き換えてループ変数の再宣言が行われている」という事実が自身のデバッグによって証明できてしまった時は本当に絶望しましたorz</p><p>詳しくは発表スライドを参照して欲しいのですが、fmtとビルトインの挙動の違いにはエスケープ解析が関係していて、この辺りは当然今回のアップデートとは無関係だったんですね。
だからこの関係性に辿り着くまでに時間がかかりましたし、実際にfmtで引数がエスケープする原因を深掘るのにも骨が折れました。</p><p>そもそもビルトイン関数の<code>print</code>なんて普段誰も使いませんし、となると当然stackoverflowなどの質問サイトにも参考になるものがなかったんですよね。
謎の証明について何のとっかかりも無くなった瞬間はすごく焦りましたし、自分の知識不足を恨みました。</p><p>でもだからこそ、(厳密には正確でないかも知れないけど)、自分が提示した謎に対して筋を通した説明が見つかった時は純粋に嬉しかったですし、高揚しました。
みんなが知らないような面白いお題が見つかって、苦節がありつつもそれを説明できるようになったからには、これをしっかり伝えたい！という気持ちが強くなりました。
そのせいでスライドが100枚ぐらいになって、登壇で半分以上省く結果になるのですが&mldr;笑</p><h2 id=登壇当日>登壇当日</h2><p>朝から登壇するまではとても緊張していて、 お昼に海鮮丼を食べた時は吐きそうになっていたぐらいです笑</p><p>けど頑張って調べてきた自由研究ですし、個人的にはすごく面白い題材だったので、"<a href="https://www.youtube.com/watch?v=gGGgoW_vgWo">訊こえるか、僕の存在証明讃歌が！</a>&ldquo;というような気持ちで、自分のセッションが始まってからはその熱量で楽しく話すことができました🔥</p><p>(自分の能力の範囲で)調べてきた結果をあんなに大勢の人に聞いてもらえるというのは、なんだか幸せな時間でした。
あぁ、よく外部登壇をしてる人は自身の発信力を上げるどうこうよりも、この楽しさを知ってからなんだろうなと感じました。</p><p>正直登壇中に聞いてくださっている方々の表情を伺う余裕はなかったのですが、発表が終わってからXを見返すと予想よりも楽しんでくれた方が多かったようでとっっっても嬉しかったです！☺️
頑張ってよかったって思いました、、、あとみんな優しいです、、🥺</p><p>以下嬉しかったツイート抜粋です&mldr;.! (無許可なので消して欲しい場合はご連絡くださいmm)</p><blockquote class=twitter-tweet><a href="https://twitter.com/tenntenn/status/1799353321997869165?ref_src=twsrc%5Etfw"></a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><blockquote class=twitter-tweet><a href="https://twitter.com/y_taka_23/status/1799354192542494787?ref_src=twsrc%5Etfw"></a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><blockquote class=twitter-tweet><a href="https://twitter.com/__syumai/status/1799353720729387350?ref_src=twsrc%5Etfw"></a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><blockquote class=twitter-tweet><a href="https://twitter.com/_ryukez/status/1799360539824722262?ref_src=twsrc%5Etfw"></a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><blockquote class=twitter-tweet><a href="https://twitter.com/B_Sardine/status/1799355116019188067?ref_src=twsrc%5Etfw"></a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><blockquote class=twitter-tweet><a href="https://twitter.com/HYorimitsu/status/1799354079174676495?ref_src=twsrc%5Etfw"></a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><blockquote class=twitter-tweet><a href="https://twitter.com/p1ass/status/1799354554578096331?ref_src=twsrc%5Etfw"></a></blockquote><script async src=https://platform.twitter.com/widgets.js></script><p>嬉しいので全部にいいねしちゃいました🥰
聞いてくれた方々、ありがとうございました！！！🎉</p><h2 id=セッションの要約推しポイント話しきれなかったこと>セッションの要約・推しポイント・話しきれなかったこと</h2><p>各章の要約と推しポイントを列挙してみました。
スライドを全て見るのがめんどくさい人や、当日省略したところを知りたい人はこちらを参照してくださいmm</p><h4 id=02章-プロポーザルやデザインドックからアップデート内容を確認する>0~2章: プロポーザルやデザインドックからアップデート内容を確認する</h4><p>2章までは、みなさまがよく知っているループに関するアップデート内容の振り返りでした。
Goconに来るような人にとっては常識だろうと思い、発表では全カットとなった部分です。</p><p>推しポイントはやはり<a href="https://speakerdeck.com/qualiarts/xiang-jie-fixing-for-loops-in-go-1-dot-22-zi-zuo-linterwogolangci-linthekontoribiyutositahua?slide=6">Goクイズ</a>です。
リリースノートの一歩先で、直感に反するようなループの挙動についてGo1.22以前と以降でそれぞれ問題を作ったのでぜひ解いてみてください。
自己紹介より前に話したかった、有識者ほど引っかかる推しの導入です。</p><p>発表で伝えられなくて最も惜しいと思ったのは<a href="https://speakerdeck.com/qualiarts/xiang-jie-fixing-for-loops-in-go-1-dot-22-zi-zuo-linterwogolangci-linthekontoribiyutositahua?slide=29">discussionにおけるC#チームの意見</a>です。
C#5.0でGo1.22と似たアップデートがあったのをご存知でしょうか？
また、C#ではfor文とfor-each文でループ変数のインスタンス割り当ての挙動が異なることを知っていますか？
Goのセマンティクス変更を後押しした面白い議論の1つなので、ぜひご覧ください。</p><h4 id=3章-コンパイラの内部実装を読み解く>3章: コンパイラの内部実装を読み解く</h4><p>3章ではコンパイラの役割を紹介した後、Go1.22から加わったloopvarパッケージについてコードリーディングしました。
どのようなケースでループ変数の暗黙的な再宣言が必要か判断され、中間表現(IR)ノードの書き換えが起きるのかを確認しました。</p><p>推しポイントは、<a href="https://speakerdeck.com/qualiarts/xiang-jie-fixing-for-loops-in-go-1-dot-22-zi-zuo-linterwogolangci-linthekontoribiyutositahua?slide=39">Goのソースコードを変更して実際にIRノードを出力するなどのデバッグを行った部分</a>ですかね。
普段Go自体のコードを変更して再ビルドすることは少ないと思うので、(自分をはじめとした)言語のデバッグ経験がない人にとってはいい例になったのではないでしょうか🙆</p><h4 id=4章-エスケープ解析>4章: エスケープ解析</h4><p>4章ではエスケープ解析とアドレス割り当て、fmtパッケージの関連性について触れました。
この章は最も力を入れた部分で、推しポイントは4つあります。</p><p>1つ目は<a href="https://speakerdeck.com/qualiarts/xiang-jie-fixing-for-loops-in-go-1-dot-22-zi-zuo-linterwogolangci-linthekontoribiyutositahua?slide=72">fmtパッケージとビルトインのプリント関数において引数のエスケープ結果が異なるという事象の解説</a>です。
本セッションの根幹部分でしたね。
一見引数のプリントするだけの処理でもレキシカルスコープを外れる可能性について示唆した<a href="https://speakerdeck.com/qualiarts/xiang-jie-fixing-for-loops-in-go-1-dot-22-zi-zuo-linterwogolangci-linthekontoribiyutositahua?slide=75">Goクイズ</a>もぜひご覧ください。</p><p>2つ目は<a href="https://speakerdeck.com/qualiarts/xiang-jie-fixing-for-loops-in-go-1-dot-22-zi-zuo-linterwogolangci-linthekontoribiyutositahua?slide=52">標準パッケージから見るエスケープ対策</a>です。<code>io.Reader</code>を参考に、変数をヒープに乗せないための面白い工夫を紹介しました。
賢ぶっても仕方がないので正直に話しますが、この例は「<a href="https://www.youtube.com/watch?v=ZMZpH4yT7M0">GopherCon2019 Understanding Allocations: the Stack and the Heap</a>」から持ってきたものです。
こちらの発表はエスケープ解析の理解を深める上でとても参考になるので、興味のある方はぜひみてみてください。</p><p>3つめは<a href="https://speakerdeck.com/qualiarts/xiang-jie-fixing-for-loops-in-go-1-dot-22-zi-zuo-linterwogolangci-linthekontoribiyutositahua?slide=80">Goディレクティブを用いて引数をエスケープさせないfmt.Printlnを作成する方法</a>です。
こちらは登壇で省略した部分で、 ディレクティブ<code>go:noescape</code>と<code>go:linkname</code>を使うことで、引数をエスケープさせない<code>fmt.Println</code>を作るという試みです。
変わり種なので省きましたが、取り組み自体は面白いと思っているので、こちらもぜひご参照ください。</p><p>4つめは<a href="https://speakerdeck.com/qualiarts/xiang-jie-fixing-for-loops-in-go-1-dot-22-zi-zuo-linterwogolangci-linthekontoribiyutositahua?slide=58">アセンブリベースでのスタック割り当ての挙動を見てみる</a>です。
こちらも発表で省略した部分です。変数がスタック割り当てになる時、実際に同じアドレスが使いまわされる挙動を確認してみよう！という趣旨のコーナーになっています。
正直自分の理解があっているか怪しい部分でもあるので、間違っていた場合はごめんなさいmm</p><h4 id=5章-周辺ツールとkaramaru-alphacopyloopvar静的解析について>5章: 周辺ツールとkaramaru-alpha/copyloopvar、静的解析について</h4><p>5章では公式から提供されたツール(<code>gcflags loopvar</code>, <code>bisect</code>)の紹介と、僕が作成したGo1.22から不要になったループ変数の再宣言を検知するリンター<a href="https://speakerdeck.com/qualiarts/xiang-jie-fixing-for-loops-in-go-1-dot-22-zi-zuo-linterwogolangci-linthekontoribiyutositahua?slide=83">copyloopvarの紹介</a>をしました。</p><p>本番では30秒で終わらせた部分ですね。笑</p><p>話す時間がなかったというのはもちろんそうなのですが、tenntennさんが300ページぐらいの解説記事を既に書かれていてこれでいいじゃん感がすごかったんです笑 (熱量がすごい)
とても自分の説明で賄える範囲ではないと考え、今回詳細は省略させていただきましたmm</p><p>本セッションの目的の1つでもあった「OSS初心者であっても言語のアップデート駆動という形で何かをつくってみるといいのではないか」ということが伝えられてよかったです。</p><p>以上が要約と推しポイントです。1つでも気になった部分があれば、ぜひスライドをご覧くださいmm</p><p><a href=https://speakerdeck.com/qualiarts/xiang-jie-fixing-for-loops-in-go-1-dot-22-zi-zuo-linterwogolangci-linthekontoribiyutositahua>speakerdeck.com - スライド全文</a></p><h2 id=おわりに>おわりに</h2><p>初めての外部登壇でしたが、とても楽しかったです！🎉</p><p>聞いてくれた方々はもちろん、貴重な経験の舞台を整えてくれた運営の方々には大感謝です🙇</p><p>絶対次もどこかで登壇したいし面白い題材を見つけていきたいです。 最高のイベントでした、ありがとうございました！</p><p><img src=pass.png alt=pass.png></p><p><img src=sign.png alt=sign.png></p></div><div class=pagination><a href=/posts/zsh-faster/ class="left arrow">&#8592;</a>
<a href=# class=top>Top</a></div></main><footer><span>&copy; <time datetime="2024-06-09 11:11:08.696972523 +0000 UTC m=+0.043454372">2024</time> karamaru. Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.</span></footer></body></html>