---
title: "uniqueパッケージから学ぶinterningと弱参照"
date: 2024-09-15T02:56:17+09:00
---


Asakusa.go#3(@ドクターズプライムさん)で登壇してきました！
Go1.23で追加されたuniqueパッケージの内部実装をたどりながら、既存の最適化やGCの挙動、弱参照について調べました。

<!--more-->

## 発表内容

{{< slide src="https://speakerdeck.com/player/e93a52af7d84472483b4a706b4bc8753" >}}

- stringの割り当てと不変性、SSAによる最適化について
- uniqueパッケージの導入背景と特性、ベンチマーク
- 主に新しく言語に取り入れられた弱参照を利用したmapの掃除について内部実装を辿る

## 雑談

準備大変だったあああ😭
セッション枠がキャンセルされてその代打を引き受けてから2週間寝ずに調査・資料作成しました。
健康とメンタルの臨界点ギリギリで密かに頑張ってました。褒めてください。

uniqueパッケージを題材に選んだ理由は、[Go1.23のリリースノート](https://tip.golang.org/doc/go1.23#new-unique-package)で挙動と存在理由が最も理解できない項目だったからです。
今回の発表準備を通じて、新しく入った機構(TrieHashMap/WeakPointer/Unique)への理解はもちろん、Goの言語特性や既に存在していた最適化についても知ることができて非常に学びになりました👏
登壇の予定は否が応でも調査を完了させなければならない強制力があるからいいですね。
特に弱参照の機構は仕組みは個人的に面白かったです！ (既にその機構が存在している他の言語利用者からすれば目新しくもなんともないかとは存じますがmm

runtimeについての知識がほぼなかったので調査が間に合うか不安でしたが、地道にコードリーディングやデバッグをして一定筋を通した資料ができてよかったです。
Go言語自身に対するデバッグ力も昔よりかは鍛えられた気がします👏

イベント当日はすごく暖かい雰囲気で、お酒を飲みながらわいわい技術の話をできるのがいい意味で不思議な感じでした。
肝心の発表は時間の想定が甘くて結構スライドを飛ばしちゃったのが惜しかったですが、伝えたいことは言えたし何より楽しかったのでよしです！
また、懇親会では様々な企業で働くエンジニアの方と情報交換できました。

余談ですが、会場にはちょっとだけ遅刻しましちゃいました、ごめんなさい😇
浅草って思ったより遠いんですね、、、タクシーを使う暴挙に出た上で間に合わなかったorz
こういう現実世界における詰めの甘いところがエンジニアの可愛げってものですよね。
嘘です、ごめんなさい。


## 関連リンク

- https://speakerdeck.com/karamaru/unique-patukezikaraxue-bu-interning-to-weak-reference
- https://asakusago.connpass.com/event/327677/
