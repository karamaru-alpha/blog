---
title: "【Unity】アセットバンドルビルド環境を脱JenkinsしてGithubActionsセルフホステッドランナーにした話"
date: 2024-08-09T00:16:21+09:00
published: false
---

ゲーム業界で伝統的に使われているABビルド*Jenkins構成を使わないために頑張っている話

<!--more-->

## 先に結論

- Jenkins*MacProからGithubActions*EC2にしたよ

## 従来の構成(Jenkins*MacPro)

### Jenkinsを使っていた背景

弊プロジェクトでは従来までJenkins*MacProという構成でアセットバンドルビルドを含む多くのタスクを実行していました。
ECSなどにJenkinsControllerとしてWebUIを、物理PCにJenkinsAgentを入れてタスクランナーとして使う感じですね。

ゲーム業界でjenkinsが使用されている理由は[こちらのブログ](https://hikyaru-suzuki.hatenablog.jp/entry/2022/12/19/140000)が全て語ってくれています。
まとめると以下です。
- **前回の実行環境を引き継いで実行したい**
    - キャッシュを使いたいがその量が(特にアセット関係は)膨大でactions/cacheの上限(10GB)を超えてしまう
- **エンジニア以外でも実行できる/見やすいUIを用意したい**
    - 非エンジニアが実行する機会が多いため、githubアカウントを持っていない人でも実行できる環境と見た目が欲しい
- 従量課金でないこと

#### Jenkins×MacProのデメリット

一方でデメリットもあります。

- Jenkins自体のメンテナンスコストが高い。pluginのアップデートなど
- GitHub上でタスク定義を管理できない
- 物理PCをメンテナンスし続けるのが大変
- タスクランナーのマシンスペックが固定される


## 新しい構成(GithubActions*EC2)

アセットバンドルビルドは依存が多くキャッシュの量も膨大なので、例えばGithubHostedRunnerのように実行環境が毎回クリーンな環境は適していません。

それに対応して、クラウドで1つコンピュートを持っておき、それをGithubActionsのセルフホステッドランナーとして登録させることで、jenkinsを使わずにワークスペースごとに環境を維持したCI環境を作ることにしました。
